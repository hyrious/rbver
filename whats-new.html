<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width">
  <title>What's New</title>
  <style>
    body { word-break: break-all }
    output {
      display: block;
      font-family: Menlo, Consolas, Roboto Mono, Ubuntu Monospace, Noto Mono, Oxygen Mono, Liberation Mono, monospace;
    }
    output h3 { margin: 8px 0 0 0; font-weight: normal }
    output p { margin: 0 }
    a {
      color: #369;
      text-decoration: none;
    }
    .i::before { content: '#' }
    .c::before { content: '::' }
    .a::before { content: '.' }
  </style>
</head>
<body>
  <base target="_blank">
  <div>Ruby version: <select id="versions"><option>1.8.7</option><option>1.9.2</option><option>1.9.3</option><option>2.0.0</option><option>2.1.3</option><option>2.1.4</option><option>2.1.5</option><option>2.1.6</option><option>2.1.7</option><option>2.1.8</option><option>2.1.9</option><option>2.2.1</option><option>2.2.2</option><option>2.2.3</option><option>2.2.4</option><option>2.2.5</option><option>2.2.6</option><option>2.3.0</option><option>2.3.1</option><option>2.3.3</option><option>2.4.1</option><option>2.4.2</option><option>2.4.3</option><option>2.4.4</option><option>2.4.5</option><option>2.5.0</option><option>2.5.1</option><option>2.5.3</option><option selected>2.6.0</option><option>2.6.1</option></select></div>
  <output id="output">
    <h3>Range</h3>
    <p><span class="i">%</span></p>
  </output>
  <script>
    (async function() {
      const select = document.getElementById('versions');
      const json = await fetch('versions.json').then(r => r.json())
      const accept = (v, ver) => v >= ver && v < ver + 10;
      const filter = ver =>
        Object.entries(json)
          .map(([k, v]) => [
            k,
            Object.entries(v)
              .map(([k, v]) => [
                k,
                k === "_"
                  ? v
                  : Object.entries(v).filter(([k, v]) => accept(v, ver))
              ])
              .filter(([k, v]) => (k === "_" ? accept(v, ver) : v.length > 0))
          ])
          .filter(([k, v]) => v.length > 0);
      function l(k, c, t) {
        return `https://ruby-doc.org/core-2.6.2/${
          k.replace(/::/g,"/")
        }.html#method-${c}-${
          encodeURIComponent(t.replace(/-/g,"-2D"))
            .replace(/%/g,"-")
            .replace(/^-/,"")
        }`;
      }
      const output = document.getElementById('output');
      function update() {
        let ver = +select.value.split('.').join('') - 100;
        ver = ~~(ver / 10) * 10;
        const filtered = filter(ver);
        while (output.firstChild) output.firstChild.remove();
        for (const [k, v] of filtered) {
          const h3 = document.createElement('h3');
          h3.append(k);
          output.append(h3);
          for (const [kk, vv] of v) {
            if (kk === '_') continue;
            const p = document.createElement('p');
            for (const [vvv, _] of vv) {
              const a = document.createElement('a');
              a.classList.add(kk);
              a.append(vvv);
              a.href = l(k, kk, vvv);
              p.append(a, ', ');
            }
            if (p.lastChild) p.lastChild.remove();
            output.append(p)
          }
        }
      }
      select.addEventListener('change', update);
      update();
    })();
  </script>
</body>
</html>